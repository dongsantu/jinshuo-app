(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/detail"],{3799:function(t,e,o){"use strict";var i=o("3854"),n=o.n(i);n.a},3854:function(t,e,o){},"59f0":function(t,e,o){"use strict";(function(t){o("20e7"),o("921b");i(o("66fd"));var e=i(o("b8bb"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("6e42")["createPage"])},"9dc2":function(t,e,o){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=d(o("a842")),s=o("43fb"),r=o("b78d"),u=o("1022"),c=o("9e41"),a=d(o("1668"));function d(t){return t&&t.__esModule?t:{default:t}}var p=function(){return Promise.all([o.e("common/vendor"),o.e("components/tki-qrcode/tki-qrcode")]).then(o.bind(null,"079a"))},h=function(){return o.e("components/_loading").then(o.bind(null,"d981"))},l=function(){return o.e("components/uni-popup/uni-popup").then(o.bind(null,"66ca"))},f=function(){return o.e("components/book-foot").then(o.bind(null,"3f4c"))},g=function(){return o.e("components/uni-tag/uni-tag").then(o.bind(null,"46db"))},v=function(){return o.e("components/uni-countdown/uni-countdown").then(o.bind(null,"aaf5"))},m=window.location.origin,b={components:{uniCountdown:v,uniTag:g,bookFoot:f,uniPopup:l,"v-loading":h,tkiQrcode:p},data:function(){return{followUrl:"",yimaiIcon:n.default,params:{useStatus:0,pageNum:1,pageSize:20,id:""},couponList:[],beloading:!1,shareQrcode:"",shareText:"",checkSkuObj:"",ifShare:!1,indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,endTime:{d:0,h:0,m:0,s:0},showFixHead:!1,product:{id:""},isCollect:!1,winHeight:320,intoView:"",topAct:"prod",prodTop:0,intructionTop:0,descTop:0}},computed:{isFans:function(){return!!(this.$store.state.login&&this.$store.state.login.user&&this.$store.state.login.user.member&&1===this.$store.state.login.user.member.isFans)},inviteCode:function(){return this.$store.state.login&&this.$store.state.login.user&&this.$store.state.login.user.userAccount?this.$store.state.login.user.userAccount.inviteCode:""},avatar:function(){return this.$store.state.login&&this.$store.state.login.user?this.$store.state.login.user.avatar:""},nickname:function(){return this.$store.state.login&&this.$store.state.login.user?this.$store.state.login.user.nickname:""},per:function(){var t={};return this.product.virtualSales&&this.product.stock?t.width=this.product.virtualSales/(Number(this.product.virtualSales)+Number(this.product.stock))*100+"%":t.width=0,t},activeStatus:function(){var t=new Date,e=t.getTime(),o=2;if(this.product.spuOtherDto&&this.product.spuOtherDto.buyStartDate&&this.product.spuOtherDto.buyEndDate){var i=new Date(Date.parse(this.product.spuOtherDto.buyStartDate.replace(/-/g,"/"))),n=new Date(Date.parse(this.product.spuOtherDto.buyEndDate.replace(/-/g,"/")));o=e<i?1:e>n?3:2}return(!this.product.stock||this.product.stock<=0)&&(o=4),o}},methods:{qrR:function(e){console.log(t("qrC:",e," at pages\\product\\detail.vue:334"))},createQrcodeFun:function(){var e=this;console.log(t("createQrcodeFun"," at pages\\product\\detail.vue:337")),this.followUrl="";var o=window.location.origin+"/#/pages/product/detail?id="+this.product.id,i=o+"&shopId="+this.$store.state.shopId,n="";this.$root.$mp.query.inviteCode&&(n=this.$root.$mp.query.inviteCode),0===this.$store.state.shopType&&n&&(i=i+"&inviteCode="+n);var r={inviteCode:n,shopId:this.$store.state.shopId,url:i};(0,s.createQrcode)(r).then(function(o){0===o.data.retCode&&(e.followUrl=o.data.result,console.log(t("this.followUrl",e.followUrl," at pages\\product\\detail.vue:358")),e.$refs.popupTopTips.open())}).catch(function(t){})},showTopTips:function(){this.createQrcodeFun()},hideTopTips:function(){this.$refs.popupTopTips.close()},copyFun:function(){i.setClipboardData({data:this.shareText,success:function(t){i.showToast({title:"复制成功，快去分享给朋友吧！",duration:2e3,icon:"none"})},fail:function(t){i.showToast({title:"复制失败，请手动复制",duration:2e3,icon:"none"})},complete:function(t){}})},receiveCouponFun:function(e){var o=this;console.log(t("couponId---",e," at pages\\product\\detail.vue:391")),(0,r.receiveCoupon)({couponId:e}).then(function(t){0===t.data.retCode?(i.showToast({title:"已领取",duration:2e3,icon:"none"}),o.getCouponsFun()):i.showToast({title:t.data.retMsg,duration:2e3,icon:"none"})}).catch(function(t){i.showToast({title:t.data.retMsg,duration:2e3,icon:"none"})})},shortUrlFun:function(){var t=this,e=m+"/#/pages/product/detail?id="+this.product.id+"&shopId="+this.$store.state.shopId;0===this.$store.state.shopType&&(e=e+"&inviteCode="+this.inviteCode),(0,r.shortUrl)({url:e}).then(function(e){e.data.success?t.shareText=t.product.name+" "+e.data.shortUrl:i.showToast({title:e.data.retMsg,duration:2e3,icon:"none"})}).catch(function(t){i.showToast({title:t.data.retMsg,duration:2e3,icon:"none"})})},getCouponsFun:function(){var t=this;this.params.id=this.product.id,this.beloading=!0,this.couponList=[],(0,r.getCoupons)(this.params).then(function(e){t.beloading=!1,0===e.data.retCode&&(t.couponList=e.data.result.list,t.pages=e.data.result.pages)}).catch(function(e){t.beloading=!1})},showShareWX:function(){this.toShare(),this.$refs.popup2.open()},hideShareWX:function(){this.$refs.popup2.close()},createSharePicFun:function(t){var e=this,o=m+"/#/pages/product/detail?id="+this.product.id+"&shopId="+this.$store.state.shopId;0===this.$store.state.shopType&&(o=o+"&inviteCode="+this.inviteCode);var n={inviteCode:this.inviteCode,headImgUrl:this.avatar,productId:t.id,referrerName:this.nickname,shareUrl:o};(0,u.createSharePic)(n).then(function(t){0===t.data.retCode&&(e.shareQrcode=e.$imgHost+t.data.result)}).catch(function(t){i.showToast({title:t.data.retMsg,duration:2e3,icon:"none"})})},createShareProductFun:function(t){var e=this,o=m+"/#/pages/product/detail?id="+this.product.id+"&shopId="+this.$store.state.shopId;0===this.$store.state.shopType&&(o=o+"&inviteCode="+this.inviteCode);var n={headImgUrl:this.avatar,productId:t.id,referrerName:this.nickname,shareUrl:o};(0,u.createShareProduct)(n).then(function(t){0===t.data.retCode&&(e.shareQrcode=e.$imgHost+t.data.result)}).catch(function(t){i.showToast({title:t.data.retMsg,duration:2e3,icon:"none"})})},showCode1:function(){this.shortUrlFun(),this.$refs.popup4.open()},showCode2:function(){this.createShareProductFun(this.product),this.$refs.popup1.open()},showMenu:function(t){this.$refs.popup.open()},hideMenu:function(){this.$refs.popup.close(),this.shareQrcode=""},showMenu1:function(){this.$refs.popup1.open()},hideMenu1:function(){console.log(t("-----\x3e"," at pages\\product\\detail.vue:538")),this.$refs.popup1.close(),this.shareQrcode=""},hideMenu4:function(){console.log(t("-----\x3e"," at pages\\product\\detail.vue:543")),this.$refs.popup4.close(),this.shareText=""},showMenu3:function(){this.$refs.popup3.open()},hideMenu3:function(){this.$refs.popup3.close()},changeSku:function(t){this.checkSkuObj=t},getIfCollectFun:function(){var t=this;(0,r.getIfCollect)({targetId:this.product.id,type:1}).then(function(e){0===e.data.retCode?t.isCollect=0===e.data.result:t.isCollect=!1}).catch(function(e){t.isCollect=!1})},delCollectFun:function(t){(0,r.delCollect)({id:t}).then(function(t){0===t.data.retCode&&i.showToast({title:"已取消收藏",duration:2e3,icon:"none"})}).catch()},addCollectFun:function(t){(0,r.addCollect)({targetId:t,type:1}).then(function(t){0===t.data.retCode&&i.showToast({title:"收藏成功",duration:2e3,icon:"none"})}).catch(function(t){i.showToast({title:t.data.retMsg,duration:2e3,icon:"none"})})},getSpuInfoBySpuIdFun:function(){var e=this;console.log(t("this.product",this.product," at pages\\product\\detail.vue:599")),(0,r.getSpuInfoBySpuId)({id:this.product.id}).then(function(o){0===o.data.retCode&&(e.product=o.data.result,e.product.spuOtherDto&&e.product.spuOtherDto.buyEndDate&&e.product.spuOtherDto.buyStartDate&&(e.endTime=c.dateUtils.getTimeF(e.product.spuOtherDto.buyEndDate),console.log(t("this.endTime",e.endTime," at pages\\product\\detail.vue:606"))),e.product.spuDescDto&&e.product.spuDescDto.mobileDesc&&(e.product.spuDescDto.mobileDesc=e.product.spuDescDto.mobileDesc.replace(/<img/g,'<img style="max-width:100%;"').replace(/<section/g,"<div").replace(/<\/section/g,"</div").replace(/&quot;/g,"'")),e.product.spuDescDto&&e.product.spuDescDto.bookingNotes&&(e.product.spuDescDto.bookingNotes=e.product.spuDescDto.bookingNotes.replace(/<img/g,'<img style="max-width:100%;"').replace(/<section/g,"<div").replace(/<\/section/g,"</div").replace(/&quot;/g,"'")),e.checkSkuObj=e.product.skus[0]),e.setHeight()}).catch()},goBuy:function(){var t=this,e="/pages/product/order?id="+t.product.id+"&shopId="+this.$store.state.shopId;this.product.skus&&this.product.skus.length>1&&this.checkSkuObj&&(e=e+"&skuId="+this.checkSkuObj.id+"&skuPrice="+this.checkSkuObj.price),i.navigateTo({url:e})},switchCollect:function(t){var e=this;e.isCollect=t,e.isCollect?e.addCollectFun(e.product.id):e.delCollectFun(e.product.id)},scrollToId:function(t){this.intoView=t},scrollTopF:function(){return 0},upper:function(){},lower:function(){},scroll:function(t){t.detail.scrollTop>150?this.showFixHead=!0:this.showFixHead=!1,this.descTop&&t.detail.scrollTop>=this.descTop?this.topAct="desc":this.instructionTop&&t.detail.scrollTop>=this.instructionTop?this.topAct="instruction":this.topAct="prod"},setHeight:function(){var t=this,e=i.createSelectorQuery();e.select("#prod").boundingClientRect(),e.exec(function(e){t.prodTop=e[0].top}),e.select("#instruction").boundingClientRect(),e.exec(function(e){t.instructionTop=e[1].top-30}),e.select("#desc").boundingClientRect(),e.exec(function(e){t.descTop=e[2].top-30})},init:function(){this.getSpuInfoBySpuIdFun(),this.getIfCollectFun(),this.getCouponsFun(),i.removeStorageSync("order")},toShare:function(){console.log(t("img",this.$imgHost+this.product.pictureUrl," at pages\\product\\detail.vue:711"));var e=window.location.href.split("#")[0],o=m+"/#/pages/product/detail?id="+this.product.id+"&shopId="+this.$store.state.shopId;0===this.$store.state.shopType&&(o=o+"&inviteCode="+this.inviteCode);var i={title:this.product.name,desc:this.product.sketch,linkurl:o,img:this.$imgHost+this.product.pictureUrl};a.default.getJSSDK(e,i)}},onShow:function(){console.log(t("show参数2",this.$root.$mp.query," at pages\\product\\detail.vue:727")),this.$root.$mp.query.id&&(this.product.id=this.$root.$mp.query.id),console.log(t("jinlai",this.product," at pages\\product\\detail.vue:731")),this.init()},onLoad:function(t){},onReady:function(){var t=this;i.getSystemInfo({success:function(e){t.winHeight=e.windowHeight}})}};e.default=b}).call(this,o("0de9")["default"],o("6e42")["default"])},b624:function(t,e,o){"use strict";var i,n=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__map(t.couponList,function(e,o){var i=e.validityStartDate.split(" "),n=e.vaildityEndDate.split(" ");return{$orig:t.__get_orig(e),g0:i,g1:n}}));t.$mp.data=Object.assign({},{$root:{l0:o}})},s=[];o.d(e,"b",function(){return n}),o.d(e,"c",function(){return s}),o.d(e,"a",function(){return i})},b8bb:function(t,e,o){"use strict";o.r(e);var i=o("b624"),n=o("cb18");for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);o("3799");var r,u=o("f0c5"),c=Object(u["a"])(n["default"],i["b"],i["c"],!1,null,"45d3bff4",null,!1,i["a"],r);e["default"]=c.exports},cb18:function(t,e,o){"use strict";o.r(e);var i=o("9dc2"),n=o.n(i);for(var s in i)"default"!==s&&function(t){o.d(e,t,function(){return i[t]})}(s);e["default"]=n.a}},[["59f0","common/runtime","common/vendor"]]]);