(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/order"],{"0945":function(o,e,t){"use strict";var r,d=function(){var o=this,e=o.$createElement;o._self._c},s=[];t.d(e,"b",function(){return d}),t.d(e,"c",function(){return s}),t.d(e,"a",function(){return r})},"09a9":function(o,e,t){"use strict";var r=t("40fe"),d=t.n(r);d.a},"0f76":function(o,e,t){"use strict";(function(o){t("20e7"),t("921b");r(t("66fd"));var e=r(t("f20f"));function r(o){return o&&o.__esModule?o:{default:o}}o(e.default)}).call(this,t("6e42")["createPage"])},"2e0e":function(o,e,t){"use strict";(function(o,r){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var d=t("b78d"),s=t("9e41"),i=function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"66ca"))},u=function(){return t.e("components/sunui-stepper/sunui-stepper").then(t.bind(null,"212d"))},n={components:{sunuiStepper:u,uniPopup:i},data:function(){return{lock:!1,couponNum:"",params:{targetCmds:[],pageNum:1,pageSize:10},couponReceiveId:"",couponAmount:"",orderNo:"",orderId:"",max:10,startT:"",endT:"",endTime:{d:0,h:0,m:0,s:0},showDetail:!1,showPay:!1,step:1,product:{id:""},order:{inviteCode:"",goodsCount:1,goodsOrderAddressCmd:{userAddress:"",userName:"",userPhone:""},goodsOrderDetailCmdList:[{discountAmount:0,discountRate:0,goodsSkuId:0,goodsSpuId:0,number:1,remarks:"",price:""}],memberId:111111,orderType:1,remarks:"",supplierId:"1111"}}},watch:{isToken:function(){this.init()}},computed:{isToken:function(){return this.$store.state.login?this.$store.state.login.token:""},qry:function(){return JSON.stringify([{count:this.count?this.count:1,targetId:this.skuId}])},count:function(){return this.order.goodsOrderDetailCmdList?this.order.goodsOrderDetailCmdList[0].number:1},skuId:function(){return this.product.skus?this.product.skus[0].id:""},sumPrice:function(){var e=0;return console.log(o("this.order.goodsOrderDetailCmdList",this.order.goodsOrderDetailCmdList," at pages\\product\\order.vue:233")),this.order.goodsOrderDetailCmdList[0].price&&(e=this.order.goodsOrderDetailCmdList[0].number*this.order.goodsOrderDetailCmdList[0].price),this.product.spuOtherDto&&this.product.spuOtherDto.courierFee&&(e+=this.product.spuOtherDto.courierFee),this.couponAmount&&(e-=this.couponAmount),e<0&&(e=0),Number(e).toFixed(2)}},onLoad:function(e){console.log(o("params",e," at pages\\product\\order.vue:251")),e.id&&(this.product.id=e.id),e.couponReceiveId&&(this.couponReceiveId=e.couponReceiveId),e.couponAmount&&(this.couponAmount=e.couponAmount),this.init()},onShow:function(){console.log(o("show参数",this.$root.$mp.query," at pages\\product\\order.vue:265")),this.$root.$mp.query.id&&(this.product.id=this.$root.$mp.query.id),this.$root.$mp.query.couponReceiveId&&(this.couponReceiveId=this.$root.$mp.query.couponReceiveId),this.$root.$mp.query.couponAmount&&(this.couponAmount=this.$root.$mp.query.couponAmount);var e=r.getStorageSync("order");console.log(o("order1",e," at pages\\product\\order.vue:277")),e&&(this.order=JSON.parse(e),console.log(o("this.order",this.order," at pages\\product\\order.vue:280"))),this.init()},onHide:function(){this.orderId="",this.orderNo="",r.setStorageSync("order",JSON.stringify(this.order)),console.log(o("order------\x3e",r.getStorageSync("order")," at pages\\product\\order.vue:288"))},onUnload:function(){this.orderId="",this.orderNo=""},methods:{gotoSuccess:function(o,e,t){setTimeout(function(){r.reLaunch({url:"/pages/product/paySuccess?price="+o+"&orderNo="+e+"&id="+t})},1900)},gotoDetail:function(o){setTimeout(function(){r.reLaunch({url:"/pages/order/detail?id="+o})},1900)},onBridgeReady:function(o,e,t,d,s,i,u,n){var a=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:o,timeStamp:e,nonceStr:t,package:d,signType:"MD5",paySign:s},function(o){"get_brand_wcpay_request:ok"==o.err_msg?(r.showToast({title:"支付成功！",duration:2e3}),a.gotoSuccess(i,u,n)):"get_brand_wcpay_request:fail"==o.err_msg&&(r.showToast({title:"支付失败！",duration:2e3,icon:"none"}),setTimeout(function(){r.reLaunch({url:"/pages/order/detail?id="+n})},1900))})},submitWXOrderFun:function(o,e,t){var s=this;(0,d.submitWXOrder)({id:o}).then(function(d){setTimeout(function(){s.lock=!1},400);var i=d.data.result;if("FAIL"==i.return_code)r.showToast({title:i.return_msg,duration:2e3,icon:"none"}),s.gotoDetail(o);else if("FAIL"==i.result_code)r.showToast({title:i.err_code_des,duration:2e3,icon:"none"}),s.gotoDetail(o);else if("FAIL"===i.needPay)r.showToast({title:"下单成功",duration:2e3,icon:"none"}),s.gotoDetail(o);else{var u=i.payappId,n=i.paytimestamp,a=i.paynonceStr,c=i.paypackage,p=i.paySign;s.onBridgeReady(u,n,a,c,p,e,t,o)}}).catch(function(e){r.showToast({title:"调用微信支付失败",duration:2e3,icon:"none"}),s.gotoDetail(o)})},changeSku:function(o){this.order.goodsOrderDetailCmdList[0].goodsSkuId=o.id,this.order.goodsOrderDetailCmdList[0].price=o.price},blurFun:function(){console.log(o("blur"," at pages\\product\\order.vue:398")),window&&(console.log(o("windowblur"," at pages\\product\\order.vue:400")),window.scrollTo(0,1))},getMyCouponByTargetIdFun:function(){var o=this;(0,d.getMyCouponByTargetId)(this.params).then(function(e){0===e.data.retCode?e.data.result&&(o.couponNum=e.data.result.total||""):o.couponNum=""}).catch(function(e){o.couponNum=""})},payFun:function(){this.submitWXOrderFun(this.orderId,this.sumPrice,this.orderNo)},createOrderFun:function(){var e=this;if(!this.lock){this.lock=!0;var t=JSON.parse(JSON.stringify(this.order));this.couponReceiveId&&(t.couponReceiveId=this.couponReceiveId);var s=r.getStorageSync("inviteCode");s&&(t.inviteCode=s),(0,d.createOrder)(t).then(function(t){console.log(o("jjll",t," at pages\\product\\order.vue:435")),0===t.data.retCode?(e.orderId=t.data.result.id,e.orderNo=t.data.result.orderNo,e.submitWXOrderFun(t.data.result.id,e.sumPrice,t.data.result.orderNo),e.closePay()):(console.log(o("cuowu--",t," at pages\\product\\order.vue:450")),r.showToast({title:t.data.retMsg,duration:2e3,icon:"none"}),e.lock=!1)}).catch(function(o){r.showToast({title:"提交订单失败",duration:2e3,icon:"none"}),e.lock=!1})}},getSpuInfoBySpuIdFun:function(){var e=this;this.max=10,(0,d.getSpuInfoBySpuId)({id:this.product.id}).then(function(t){0===t.data.retCode&&(e.product=t.data.result,e.product.stock&&e.product.stock<e.max?e.max=e.product.stock:e.max=0,e.product.spuOtherDto&&e.product.spuOtherDto.buyEndDate&&e.product.spuOtherDto.buyStartDate&&(e.endTime=s.dateUtils.getTimeF(e.product.spuOtherDto.buyEndDate),console.log(o("this.endTime",e.endTime," at pages\\product\\order.vue:483"))),console.log(o("this.product.skus[0].id",e.product.skus[0].id," at pages\\product\\order.vue:485")),r.getStorageSync("order")||(e.order.goodsOrderDetailCmdList[0].goodsSkuId=e.product.skus[0].id,console.log(o("this.order.goodsOrderDetailCmdList[0].goodsSkuId",e.order.goodsOrderDetailCmdList[0].goodsSkuId," at pages\\product\\order.vue:489")),e.order.goodsOrderDetailCmdList[0].goodsSpuId=e.product.skus[0].spuId,e.order.goodsOrderDetailCmdList[0].price=e.product.skus[0].price,e.order.orderType=e.product.typeId,e.$root.$mp.query.skuId&&(e.order.goodsOrderDetailCmdList[0].goodsSkuId=e.$root.$mp.query.skuId),e.$root.$mp.query.skuPrice&&(e.order.goodsOrderDetailCmdList[0].price=e.$root.$mp.query.skuPrice)))}).catch()},init:function(){if(this.isToken&&(this.getSpuInfoBySpuIdFun(),this.getMyCouponByTargetIdFun()),this.$root.$mp.query.address){var e=JSON.parse(this.$root.$mp.query.address);this.order.goodsOrderAddressCmd.userName=e.userName,this.order.goodsOrderAddressCmd.userPhone=e.userPhone,this.order.goodsOrderAddressCmd.userAddress=e.userAddress,console.log(o("this.order.goodsOrderAddressCmd",this.order.goodsOrderAddressCmd," at pages\\product\\order.vue:526"))}},submitFun:function(){s.validator.ifEmpty(this.order.goodsOrderAddressCmd.userName,"请填写联系人姓名")||s.validator.ifEmpty(this.order.goodsOrderAddressCmd.userPhone,"请填写联系人手机")||s.validator.ifPhone(this.order.goodsOrderAddressCmd.userPhone,"联系人手机格式不正确")||(this.$refs.popup.close(),this.$refs.popup1.open(),this.showPay=!0)},closePay:function(){this.$refs.popup1.close(),this.showPay=!1},showDetailFun:function(){this.showDetail=!0,this.$refs.popup.open()},hideDetailF:function(){console.log(o("this---",this," at pages\\product\\order.vue:550"));var e=this;e.showDetail=!1},hideDetailFun:function(){this.showDetail=!1,this.$refs.popup.close()},stepperChange:function(o){this.order.goodsOrderDetailCmdList[0].number=o.val}}};e.default=n}).call(this,t("0de9")["default"],t("6e42")["default"])},"40fe":function(o,e,t){},"9db4":function(o,e,t){"use strict";t.r(e);var r=t("2e0e"),d=t.n(r);for(var s in r)"default"!==s&&function(o){t.d(e,o,function(){return r[o]})}(s);e["default"]=d.a},f20f:function(o,e,t){"use strict";t.r(e);var r=t("0945"),d=t("9db4");for(var s in d)"default"!==s&&function(o){t.d(e,o,function(){return d[o]})}(s);t("09a9");var i,u=t("f0c5"),n=Object(u["a"])(d["default"],r["b"],r["c"],!1,null,"4335bd7b",null,!1,r["a"],i);e["default"]=n.exports}},[["0f76","common/runtime","common/vendor"]]]);